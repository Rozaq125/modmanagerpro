<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ModHub - Komunitas Download Mods Terbaik</title>
  <!-- Tailwind CSS via CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Custom Fonts -->
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-900 font-sans text-gray-100">

  <!-- Header Section -->
  <header class="sticky top-0 z-40 bg-gray-800 shadow-lg">
    <div class="mx-auto flex max-w-7xl items-center justify-between p-4 sm:px-6 lg:px-8">
      <!-- Logo and Navigation -->
      <div class="flex items-center space-x-4">
        <h1 class="text-3xl font-bold tracking-tight text-white">
          <a href="#" class="hover:text-blue-400">ModHub</a>
        </h1>
        <nav class="hidden space-x-4 text-sm font-medium md:flex">
          <a href="#" class="rounded-full px-3 py-2 transition-colors hover:bg-gray-700 hover:text-blue-400">Beranda</a>
          <a href="#" class="rounded-full px-3 py-2 transition-colors hover:bg-gray-700 hover:text-blue-400">Mods</a>
          <a href="#" class="rounded-full px-3 py-2 transition-colors hover:bg-gray-700 hover:text-blue-400">Modpacks</a>
          <a href="#" class="rounded-full px-3 py-2 transition-colors hover:bg-gray-700 hover:text-blue-400">Panduan</a>
        </nav>
      </div>

      <!-- Action Buttons -->
      <div class="flex items-center space-x-2">
        <button id="upload-btn" class="flex items-center space-x-2 rounded-full bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900">
          <!-- Icon SVG -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
          </svg>
          <span class="hidden md:inline">Unggah File</span>
        </button>
        <!-- Login/Profile section -->
        <div id="auth-container" class="relative">
          <!-- Button to open login modal -->
          <button id="login-btn" class="flex items-center space-x-2 rounded-full bg-gray-700 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span class="hidden md:inline">Login / Daftar</span>
          </button>
          <!-- Profile dropdown (hidden by default) -->
          <div id="profile-dropdown" class="absolute right-0 mt-2 hidden w-48 rounded-lg bg-gray-700 py-2 shadow-lg ring-1 ring-gray-900 ring-opacity-5 focus:outline-none">
            <p id="profile-name" class="block truncate px-4 py-2 text-sm text-white">Nama Pengguna</p>
            <button id="logout-btn-dropdown" class="block w-full px-4 py-2 text-left text-sm text-red-400 hover:bg-gray-600">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content Area -->
  <main class="mx-auto max-w-7xl p-4 sm:px-6 lg:px-8">
    <div class="py-8">
      <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Temukan Mod Favorit Anda</h2>
      <p class="mt-2 text-lg text-gray-400">Jelajahi ribuan mod, modpack, panduan, dan bantuan dari komunitas kami.</p>
    </div>

    <!-- Mod Cards Grid -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
      <!-- Mock Card 1 -->
      <div class="group overflow-hidden rounded-xl bg-gray-800 shadow-xl transition-all hover:scale-105 hover:shadow-2xl">
        <div class="relative overflow-hidden">
          <img src="https://placehold.co/400x225/444/FFF?text=Mobil+Mod" alt="Gambar dari Mod Mobil Sport V1" class="w-full object-cover transition-transform duration-300 group-hover:scale-110" style="aspect-ratio: 16 / 9;">
          <div class="absolute right-2 top-2 rounded-full bg-gray-900 bg-opacity-70 px-3 py-1 text-xs font-semibold text-white">Mods</div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-white transition-colors group-hover:text-blue-400">Mod Mobil Sport V1</h3>
          <p class="mt-1 text-sm text-gray-400">Oleh: Jane Doe</p>
        </div>
      </div>
      <!-- Mock Card 2 -->
      <div class="group overflow-hidden rounded-xl bg-gray-800 shadow-xl transition-all hover:scale-105 hover:shadow-2xl">
        <div class="relative overflow-hidden">
          <img src="https://placehold.co/400x225/555/FFF?text=Modpack+Kota" alt="Gambar dari Modpack Kota V2.1" class="w-full object-cover transition-transform duration-300 group-hover:scale-110" style="aspect-ratio: 16 / 9;">
          <div class="absolute right-2 top-2 rounded-full bg-gray-900 bg-opacity-70 px-3 py-1 text-xs font-semibold text-white">Modpack</div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-white transition-colors group-hover:text-blue-400">Modpack Kota V2.1</h3>
          <p class="mt-1 text-sm text-gray-400">Oleh: John Smith</p>
        </div>
      </div>
      <!-- Mock Card 3 -->
      <div class="group overflow-hidden rounded-xl bg-gray-800 shadow-xl transition-all hover:scale-105 hover:shadow-2xl">
        <div class="relative overflow-hidden">
          <img src="https://placehold.co/400x225/666/FFF?text=Panduan+Install" alt="Gambar dari Panduan Instalasi Lengkap" class="w-full object-cover transition-transform duration-300 group-hover:scale-110" style="aspect-ratio: 16 / 9;">
          <div class="absolute right-2 top-2 rounded-full bg-gray-900 bg-opacity-70 px-3 py-1 text-xs font-semibold text-white">Panduan</div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-white transition-colors group-hover:text-blue-400">Panduan Instalasi Lengkap</h3>
          <p class="mt-1 text-sm text-gray-400">Oleh: Game Guru</p>
        </div>
      </div>
      <!-- Mock Card 4 -->
      <div class="group overflow-hidden rounded-xl bg-gray-800 shadow-xl transition-all hover:scale-105 hover:shadow-2xl">
        <div class="relative overflow-hidden">
          <img src="https://placehold.co/400x225/777/FFF?text=Bantuan+Grafis" alt="Gambar dari Bantuan Masalah Grafis" class="w-full object-cover transition-transform duration-300 group-hover:scale-110" style="aspect-ratio: 16 / 9;">
          <div class="absolute right-2 top-2 rounded-full bg-gray-900 bg-opacity-70 px-3 py-1 text-xs font-semibold text-white">Bantuan</div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-white transition-colors group-hover:text-blue-400">Bantuan Masalah Grafis</h3>
          <p class="mt-1 text-sm text-gray-400">Oleh: Tech Help</p>
        </div>
      </div>
      <!-- Mock Card 5 -->
      <div class="group overflow-hidden rounded-xl bg-gray-800 shadow-xl transition-all hover:scale-105 hover:shadow-2xl">
        <div class="relative overflow-hidden">
          <img src="https://placehold.co/400x225/444/FFF?text=Mobil+Mod+V2" alt="Gambar dari Mod Mobil Sport V2" class="w-full object-cover transition-transform duration-300 group-hover:scale-110" style="aspect-ratio: 16 / 9;">
          <div class="absolute right-2 top-2 rounded-full bg-gray-900 bg-opacity-70 px-3 py-1 text-xs font-semibold text-white">Mods</div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-white transition-colors group-hover:text-blue-400">Mod Mobil Sport V2</h3>
          <p class="mt-1 text-sm text-gray-400">Oleh: Jane Doe</p>
        </div>
      </div>
      <!-- Mock Card 6 -->
      <div class="group overflow-hidden rounded-xl bg-gray-800 shadow-xl transition-all hover:scale-105 hover:shadow-2xl">
        <div class="relative overflow-hidden">
          <img src="https://placehold.co/400x225/555/FFF?text=Modpack+Kehidupan" alt="Gambar dari Modpack Kehidupan Kota" class="w-full object-cover transition-transform duration-300 group-hover:scale-110" style="aspect-ratio: 16 / 9;">
          <div class="absolute right-2 top-2 rounded-full bg-gray-900 bg-opacity-70 px-3 py-1 text-xs font-semibold text-white">Modpack</div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-white transition-colors group-hover:text-blue-400">Modpack Kehidupan Kota</h3>
          <p class="mt-1 text-sm text-gray-400">Oleh: John Smith</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer Section -->
  <footer class="mt-12 bg-gray-800 py-6">
    <div class="mx-auto max-w-7xl text-center text-sm text-gray-400">
      &copy; 2024 ModHub. Semua Hak Cipta Dilindungi.
    </div>
  </footer>

  <!-- Login/Register Modal -->
  <div id="login-modal" class="fixed inset-0 z-50 flex items-center justify-center overflow-y-auto bg-gray-900 bg-opacity-70 p-4 opacity-0 transition-all duration-300 ease-in-out pointer-events-none">
    <div class="relative w-full max-w-xl rounded-2xl bg-gray-800 p-6 text-left align-middle shadow-xl">
      <button id="close-login-modal" class="absolute right-4 top-4 rounded-full bg-gray-700 p-2 text-white transition-colors hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500" aria-label="Tutup">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
      <h3 class="text-center text-2xl font-bold text-white">Login ke Akun Anda</h3>
      <div class="mt-4 flex justify-center">
        <button id="login-tab" class="rounded-l-lg px-6 py-2 transition-colors bg-blue-600 text-white">Login</button>
        <button id="register-tab" class="rounded-r-lg px-6 py-2 transition-colors bg-gray-700 text-gray-300 hover:bg-gray-600">Daftar</button>
      </div>
      <!-- Login Form -->
      <form id="login-form" class="mt-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-300">Email</label>
          <input type="email" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Password</label>
          <input type="password" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <button type="submit" class="w-full rounded-md bg-blue-600 px-4 py-2 font-semibold text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900">Login</button>
      </form>
      <!-- Register Form (Initially Hidden) -->
      <form id="register-form" class="mt-6 space-y-4 hidden">
        <div>
          <label class="block text-sm font-medium text-gray-300">Email</label>
          <input type="email" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Password</label>
          <input type="password" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Konfirmasi Password</label>
          <input type="password" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <button type="submit" class="w-full rounded-md bg-blue-600 px-4 py-2 font-semibold text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900">Daftar</button>
      </form>

      <!-- Divider -->
      <div class="my-6 flex items-center">
        <div class="h-px flex-grow bg-gray-600"></div>
        <span class="mx-4 text-sm text-gray-400">ATAU</span>
        <div class="h-px flex-grow bg-gray-600"></div>
      </div>
      
      <!-- Google Login Button -->
      <button id="google-login-btn" class="w-full rounded-md bg-white px-4 py-2 text-center font-semibold text-gray-800 transition-colors hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900">
        <div class="flex items-center justify-center">
          <svg class="mr-2 h-5 w-5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.0001 4.75C14.0734 4.75 15.8344 5.4859 17.1593 6.7588L20.0886 3.8295C18.0673 1.83984 15.2281 0.75 12.0001 0.75C7.29177 0.75 3.20815 3.49072 1.44293 7.51478L4.69747 9.94828C5.50361 7.42784 8.21443 5.44192 12.0001 4.75Z" fill="#EA4335" />
            <path d="M23.2501 12.2741C23.2501 11.4503 23.1812 10.6385 23.0487 9.8596L12.0001 9.8596V14.2818H18.2323C17.9405 15.8672 17.0601 17.1856 15.807 18.037L18.9189 20.463C21.1441 18.4239 22.5001 15.421 22.5001 12.2741Z" fill="#4285F4" />
            <path d="M1.44293 7.51478C1.19692 8.25736 1.05566 9.03541 1.05566 9.8596C1.05566 10.6838 1.19692 11.4619 1.44293 12.2045L1.47253 12.2858L4.69747 14.7193L4.85191 14.8091C5.50361 17.3308 8.21443 19.317 12.0001 20.0054C15.2281 20.6937 18.0673 19.6053 20.0886 17.6156L17.1593 14.6864C15.8344 15.9593 14.0734 16.6952 12.0001 16.6952C8.21443 16.6952 5.50361 14.7092 4.69747 12.1888L1.44293 7.51478Z" fill="#FBBC04" />
            <path d="M12.0001 20.0054C11.5173 20.0054 11.037 19.9572 10.5694 19.8659C9.99222 19.7468 9.42146 19.578 8.87784 19.3627C8.45524 19.2046 8.0463 19.0145 7.65345 18.7958C7.15654 18.5256 6.67138 18.2132 6.20815 17.8659L2.95361 20.2994C3.89679 21.018 4.96229 21.5796 6.11333 22.0152C7.26437 22.4508 8.48972 22.6865 9.74906 22.75C10.9856 22.8135 12.2475 22.7161 13.488 22.4589C14.7285 22.2016 15.9328 21.7828 17.0658 21.2066L13.9539 18.7807C13.2505 19.3491 12.5161 19.7891 11.7507 20.1082C11.0069 20.4079 10.222 20.556 9.41872 20.556C8.80277 20.556 8.19662 20.4725 7.60943 20.3061C6.98522 20.129 6.38128 19.8972 5.80803 19.6171L12.0001 20.0054Z" fill="#34A853" />
            <path d="M12.0001 20.0054C11.5173 20.0054 11.037 19.9572 10.5694 19.8659C9.99222 19.7468 9.42146 19.578 8.87784 19.3627C8.45524 19.2046 8.0463 19.0145 7.65345 18.7958C7.15654 18.5256 6.67138 18.2132 6.20815 17.8659L2.95361 20.2994C3.89679 21.018 4.96229 21.5796 6.11333 22.0152C7.26437 22.4508 8.48972 22.6865 9.74906 22.75C10.9856 22.8135 12.2475 22.7161 13.488 22.4589C14.7285 22.2016 15.9328 21.7828 17.0658 21.2066L13.9539 18.7807C13.2505 19.3491 12.5161 19.7891 11.7507 20.1082C11.0069 20.4079 10.222 20.556 9.41872 20.556C8.80277 20.556 8.19662 20.4725 7.60943 20.3061C6.98522 20.129 6.38128 19.8972 5.80803 19.6171L12.0001 20.0054Z" fill="#34A853" />
          </svg>
          Login dengan Google
        </div>
      </button>

    </div>
  </div>

  <!-- Upload Modal -->
  <div id="upload-modal" class="fixed inset-0 z-50 flex items-center justify-center overflow-y-auto bg-gray-900 bg-opacity-70 p-4 opacity-0 transition-all duration-300 ease-in-out pointer-events-none">
    <div class="relative w-full max-w-2xl rounded-2xl bg-gray-800 p-6 text-left align-middle shadow-xl">
      <button id="close-upload-modal" class="absolute right-4 top-4 rounded-full bg-gray-700 p-2 text-white transition-colors hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500" aria-label="Tutup">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
      <h3 class="text-center text-2xl font-bold text-white">Unggah File Baru</h3>
      <form id="upload-form" class="mt-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-300">Judul</label>
          <input type="text" id="upload-title" placeholder="Judul Mod/Panduan Anda" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Deskripsi Lengkap</label>
          <textarea rows="5" id="upload-description" placeholder="Jelaskan fitur, perubahan, dan instruksi instalasi" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Tautan Unduhan (Google Drive)</label>
          <input type="url" id="upload-link" placeholder="https://drive.google.com/..." class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
          <div>
            <label class="block text-sm font-medium text-gray-300">Kategori</label>
            <select id="upload-category" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500">
              <option value="">Pilih Kategori</option>
              <option value="mods">Mods</option>
              <option value="modpacks">Modpacks</option>
              <option value="guides">Panduan</option>
              <option value="help">Bantuan</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300">Versi</label>
            <input type="text" id="upload-version" placeholder="misal: v1.0, 2.1" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Foto Utama</label>
          <input type="file" id="upload-image" class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-700 p-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Tautan Video Tutorial (Opsional)</label>
          <input type="url" id="upload-video" placeholder="https://www.youtube.com/..." class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 px-3 py-2 text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="ownership" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500" />
          <label for="ownership" class="ml-2 text-sm text-gray-300">Ini adalah karya saya</label>
        </div>
        <button id="save-data-btn" type="button" class="w-full rounded-md bg-green-600 px-4 py-2 font-semibold text-white transition-colors hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-900">
          Simpan Data ke Firebase
        </button>
      </form>
      <!-- Message box for user feedback -->
      <div id="message-box" class="mt-4 hidden p-3 text-sm rounded-md text-white"></div>
    </div>
  </div>

  <script type="module">
    // Mengimpor modul Firebase yang dibutuhkan
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Konfigurasi Firebase Anda yang sudah diberikan
    const firebaseConfig = {
      apiKey: "AIzaSyAlGXpZSyQab7riDteV5ppS3DXDJQHywKw",
      authDomain: "modmanagerpro-248f5.firebaseapp.com",
      projectId: "modmanagerpro-248f5",
      storageBucket: "modmanagerpro-248f5.firebasestorage.app",
      messagingSenderId: "594650288669",
      appId: "1:594650288669:web:3074c3f2f0249bc6f1ecf4",
      measurementId: "G-VLWZDSRS3W"
    };

    // Ini adalah variabel global yang disediakan environment.
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    let app, auth, db, userId = null;

    // Fungsi untuk menampilkan pesan ke pengguna (pengganti alert)
    const showMessage = (message, type = 'success') => {
      const messageBox = document.getElementById('message-box');
      messageBox.textContent = message;
      messageBox.className = 'mt-4 p-3 text-sm rounded-md text-white';
      if (type === 'success') {
        messageBox.classList.add('bg-green-600');
      } else if (type === 'error') {
        messageBox.classList.add('bg-red-600');
      }
      messageBox.classList.remove('hidden');
    };

    // Fungsi untuk memperbarui tampilan UI berdasarkan status login
    const updateAuthUI = (user) => {
      const loginBtn = document.getElementById('login-btn');
      const profileName = document.getElementById('profile-name');
      const profileDropdown = document.getElementById('profile-dropdown');
      const authContainer = document.getElementById('auth-container');
      const uploadBtn = document.getElementById('upload-btn');

      if (user) {
        // Pengguna sudah login
        loginBtn.innerHTML = `<img src="${user.photoURL || 'https://placehold.co/24x24/1F2937/FFFFFF?text=P'}" alt="Profile" class="h-6 w-6 rounded-full border-2 border-white">`;
        loginBtn.title = user.displayName || 'Akun Anda';
        
        // Show profile dropdown on hover/click
        authContainer.addEventListener('mouseenter', () => profileDropdown.classList.remove('hidden'));
        authContainer.addEventListener('mouseleave', () => profileDropdown.classList.add('hidden'));

        // Update profile name in dropdown
        profileName.textContent = user.displayName || 'Pengguna';
        
        // Aktifkan tombol unggah
        uploadBtn.disabled = false;
        uploadBtn.classList.remove('bg-gray-500', 'cursor-not-allowed');
        uploadBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
      } else {
        // Pengguna belum login
        loginBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg><span class="hidden md:inline">Login / Daftar</span>`;
        loginBtn.title = 'Login';
        
        // Sembunyikan dropdown profil
        profileDropdown.classList.add('hidden');

        // Non-aktifkan tombol unggah
        uploadBtn.disabled = true;
        uploadBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        uploadBtn.classList.add('bg-gray-500', 'cursor-not-allowed');
      }
    };

    // Inisialisasi Firebase dan otentikasi
    const initFirebase = async () => {
      if (Object.keys(firebaseConfig).length === 0) {
        console.error("Firebase config tidak tersedia.");
        showMessage("Kesalahan: Konfigurasi Firebase tidak ditemukan.", "error");
        return;
      }
      
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);

      onAuthStateChanged(auth, async (user) => {
        updateAuthUI(user);
        if (user) {
          userId = user.uid;
          console.log("Pengguna terotentikasi:", userId);
          showMessage(`Halo, ${user.displayName || 'Pengguna'}! Anda berhasil terhubung ke Firebase!`, "success");
        } else {
          try {
            if (initialAuthToken) {
              await signInWithCustomToken(auth, initialAuthToken);
            } else {
              await signInAnonymously(auth);
            }
          } catch (error) {
            console.error("Gagal melakukan otentikasi:", error);
            showMessage("Gagal terhubung ke Firebase. Silakan coba lagi.", "error");
          }
        }
      });
    };

    // Fungsi untuk menyimpan data unggahan ke Firestore
    const saveUploadToFirestore = async (uploadData) => {
      if (!userId) {
        showMessage("Error: Pengguna belum terotentikasi.", "error");
        return;
      }
      try {
        const uploadDocRef = doc(db, `artifacts/${appId}/users/${userId}/uploads/contoh-unggah-${Date.now()}`);
        await setDoc(uploadDocRef, {
          ...uploadData,
          uploadedBy: userId,
          uploadedAt: new Date(),
        });
        showMessage("Data berhasil disimpan ke Firebase!", "success");
      } catch (e) {
        console.error("Error saat menambahkan dokumen:", e);
        showMessage("Terjadi kesalahan saat menyimpan data.", "error");
      }
    };

    // Handler untuk login dengan Google
    const handleGoogleLogin = async () => {
      const provider = new GoogleAuthProvider();
      try {
        await signInWithPopup(auth, provider);
        showMessage("Login dengan Google berhasil!", "success");
        closeModal(document.getElementById('login-modal'));
      } catch (error) {
        console.error("Error saat login dengan Google:", error);
        showMessage(`Gagal login dengan Google: ${error.message}`, "error");
      }
    };
    
    // Handler untuk logout
    const handleLogout = async () => {
      try {
        await signOut(auth);
        showMessage("Anda berhasil logout.", "success");
        updateAuthUI(null);
      } catch (error) {
        console.error("Error saat logout:", error);
        showMessage(`Gagal logout: ${error.message}`, "error");
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      // Panggil inisialisasi Firebase saat DOM siap
      initFirebase();

      // Dapatkan referensi elemen UI
      const loginModal = document.getElementById('login-modal');
      const uploadModal = document.getElementById('upload-modal');
      const loginBtn = document.getElementById('login-btn');
      const uploadBtn = document.getElementById('upload-btn');
      const closeLoginModalBtn = document.getElementById('close-login-modal');
      const closeUploadModalBtn = document.getElementById('close-upload-modal');
      const loginTabBtn = document.getElementById('login-tab');
      const registerTabBtn = document.getElementById('register-tab');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const saveDataBtn = document.getElementById('save-data-btn');
      const googleLoginBtn = document.getElementById('google-login-btn');
      const logoutBtnDropdown = document.getElementById('logout-btn-dropdown');
      const profileDropdown = document.getElementById('profile-dropdown');
      const authContainer = document.getElementById('auth-container');


      // Fungsi untuk membuka modal
      function openModal(modal) {
        modal.classList.remove('opacity-0', 'pointer-events-none');
        modal.classList.add('opacity-100');
        modal.scrollTop = 0;
      }

      // Fungsi untuk menutup modal
      function closeModal(modal) {
        modal.classList.remove('opacity-100');
        modal.classList.add('opacity-0', 'pointer-events-none');
      }

      // Event listener untuk tombol-tombol
      loginBtn.addEventListener('click', (e) => {
        // Prevent opening modal if user is logged in and it's a profile picture click
        if (auth.currentUser) {
           profileDropdown.classList.toggle('hidden');
        } else {
           openModal(loginModal);
        }
        e.stopPropagation();
      });
      // Close dropdown if clicked outside
      document.addEventListener('click', (e) => {
        if (!authContainer.contains(e.target)) {
          profileDropdown.classList.add('hidden');
        }
      });
      uploadBtn.addEventListener('click', () => {
        if (!auth.currentUser) {
          showMessage("Anda harus login untuk mengunggah file.", "error");
          openModal(loginModal);
        } else {
          openModal(uploadModal);
        }
      });
      closeLoginModalBtn.addEventListener('click', () => closeModal(loginModal));
      closeUploadModalBtn.addEventListener('click', () => closeModal(uploadModal));
      
      // Menutup modal ketika klik di luar area modal
      loginModal.addEventListener('click', (e) => {
        if (e.target === loginModal) {
          closeModal(loginModal);
        }
      });
      uploadModal.addEventListener('click', (e) => {
        if (e.target === uploadModal) {
          closeModal(uploadModal);
        }
      });

      // Menangani peralihan tab Login/Daftar
      loginTabBtn.addEventListener('click', () => {
        loginTabBtn.classList.add('bg-blue-600', 'text-white');
        loginTabBtn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
        registerTabBtn.classList.remove('bg-blue-600', 'text-white');
        registerTabBtn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
      });

      registerTabBtn.addEventListener('click', () => {
        registerTabBtn.classList.add('bg-blue-600', 'text-white');
        registerTabBtn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
        loginTabBtn.classList.remove('bg-blue-600', 'text-white');
        loginTabBtn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
        registerForm.classList.remove('hidden');
        loginForm.classList.add('hidden');
      });
      
      // Event listener untuk tombol 'Simpan Data'
      saveDataBtn.addEventListener('click', () => {
        const title = document.getElementById('upload-title').value;
        const description = document.getElementById('upload-description').value;
        const link = document.getElementById('upload-link').value;
        const category = document.getElementById('upload-category').value;
        const version = document.getElementById('upload-version').value;

        if (!title || !description || !link || !category || !version) {
          showMessage("Semua kolom kecuali video harus diisi!", "error");
          return;
        }

        const uploadData = {
          title,
          description,
          downloadLink: link,
          category,
          version,
        };

        saveUploadToFirestore(uploadData);
      });

      // Event listeners untuk login/logout Google
      googleLoginBtn.addEventListener('click', handleGoogleLogin);
      logoutBtnDropdown.addEventListener('click', handleLogout);

    });
  </script>
</body>
</html>

